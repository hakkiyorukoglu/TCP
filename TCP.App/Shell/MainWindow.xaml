<Window x:Class="TCP.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TCP.App"
        xmlns:views="clr-namespace:TCP.App.Views"
        xmlns:services="clr-namespace:TCP.App.Services"
        xmlns:viewmodels="clr-namespace:TCP.App.ViewModels"
        mc:Ignorable="d"
        Title="TCP" Height="600" Width="1000"
        Background="{DynamicResource Brush.Background.Primary}"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanResize">
    <Window.DataContext>
        <viewmodels:MainViewModel/>
    </Window.DataContext>
    <Window.Resources>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:IsNullOrEmptyConverter x:Key="IsNullOrEmptyConverter"/>
        <local:ThicknessConverter x:Key="ThicknessConverter"/>
        <local:CornerRadiusConverter x:Key="CornerRadiusConverter"/>
    </Window.Resources>
    <!--
        MainWindow.xaml - Application Shell
        
        TCP-0.4: Navigation Shell + Stable Startup
        Bu pencere uygulamanÄ±n ana shell'idir.
        
        Layout:
        1. TopBar: Sabit yÃ¼kseklikte Ã¼st Ã§ubuk (navigation, icons, window buttons)
        2. ContentArea: Ana iÃ§erik alanÄ± (View switching iÃ§in ContentControl)
        
        Ã–NEMLÄ°: 
        - Hardcoded renk kullanÄ±lmÄ±yor, tÃ¼m renkler ThemeTokens'tan geliyor
        - WindowStyle="None" ile custom chrome kullanÄ±yoruz
        - Navigation basit ve stable (NO complex router)
    -->
    <Grid>
        <Grid.RowDefinitions>
            <!-- TopBar iÃ§in sabit yÃ¼kseklik -->
            <RowDefinition Height="50"/>
            <!-- Content area iÃ§in kalan alan -->
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!--
            TopBar - Ãœst navigasyon Ã§ubuÄŸu
            Sol: Uygulama adÄ± + subtitle
            Orta: Navigation tabs (Home, Electronics, Simulation, Editor)
            SaÄŸ: Search icon, Settings icon, Info icon, Version, Window buttons
        -->
        <Border Grid.Row="0" 
                Background="{DynamicResource Brush.Surface}"
                BorderBrush="{DynamicResource Brush.Border}"
                BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <!-- Sol: App name + subtitle -->
                    <ColumnDefinition Width="Auto"/>
                    <!-- Orta: Navigation tabs -->
                    <ColumnDefinition Width="*"/>
                    <!-- SaÄŸ: Icons + Version + Window buttons -->
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Sol: Uygulama adÄ± ve subtitle -->
                <StackPanel Grid.Column="0"
                            Orientation="Vertical"
                            VerticalAlignment="Center"
                            Margin="15,0,20,0">
                    <TextBlock Text="TCP"
                               FontSize="{StaticResource FontSize.L}"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource Brush.Text.Primary}"/>
                    <TextBlock Text="Train Control Platform"
                               FontSize="{StaticResource FontSize.XS}"
                               Foreground="{DynamicResource Brush.Text.Secondary}"
                               Margin="0,-2,0,0"/>
                </StackPanel>
                
                <!-- Orta: Navigation tabs -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <!-- Home tab -->
                    <TextBlock x:Name="HomeTab"
                               Text="Home"
                               FontSize="13"
                               Foreground="{DynamicResource Brush.Text.Primary}"
                               VerticalAlignment="Center"
                               Margin="10,0"
                               Padding="8,4"
                               Cursor="Hand"
                               MouseLeftButtonDown="HomeTab_MouseLeftButtonDown">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="{DynamicResource AccentPrimaryBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    
                    <!-- Electronics tab -->
                    <TextBlock x:Name="ElectronicsTab"
                               Text="Electronics"
                               FontSize="13"
                               Foreground="{DynamicResource Brush.Text.Secondary}"
                               VerticalAlignment="Center"
                               Margin="10,0"
                               Padding="8,4"
                               Cursor="Hand"
                               MouseLeftButtonDown="ElectronicsTab_MouseLeftButtonDown">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="{DynamicResource AccentPrimaryBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    
                    <!-- Simulation tab -->
                    <TextBlock x:Name="SimulationTab"
                               Text="Simulation"
                               FontSize="13"
                               Foreground="{DynamicResource Brush.Text.Secondary}"
                               VerticalAlignment="Center"
                               Margin="10,0"
                               Padding="8,4"
                               Cursor="Hand"
                               MouseLeftButtonDown="SimulationTab_MouseLeftButtonDown">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="{DynamicResource AccentPrimaryBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    
                    <!-- Editor tab -->
                    <TextBlock x:Name="EditorTab"
                               Text="Editor"
                               FontSize="13"
                               Foreground="{DynamicResource Brush.Text.Secondary}"
                               VerticalAlignment="Center"
                               Margin="10,0"
                               Padding="8,4"
                               Cursor="Hand"
                               MouseLeftButtonDown="EditorTab_MouseLeftButtonDown">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="{DynamicResource AccentPrimaryBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
                
                <!-- SaÄŸ: Search + Icons + Version + Window buttons -->
                <Grid Grid.Column="2">
                    <Grid.ColumnDefinitions>
                        <!-- Search box -->
                        <ColumnDefinition Width="Auto"/>
                        <!-- Icons + Version -->
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Search Box with Dropdown -->
                    <!-- TCP-0.6.0: Popup overlay - does NOT affect layout -->
                    <Grid Grid.Column="0"
                          Margin="0,0,15,0"
                          VerticalAlignment="Center">
                        <!-- Search TextBox -->
                        <Grid>
                            <Border x:Name="SearchTextBoxBorder"
                                    Background="{DynamicResource Brush.Surface}"
                                    BorderBrush="{DynamicResource Brush.Border}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="8,5">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Search input -->
                                    <TextBox Grid.Column="0"
                                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{DynamicResource Brush.Text.Primary}"
                                             FontSize="12"
                                             VerticalContentAlignment="Center"
                                             Padding="0,0,5,0">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="TextBox">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    BorderThickness="0">
                                                                <ScrollViewer x:Name="PART_ContentHost"
                                                                              Margin="{TemplateBinding Padding}"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </TextBox.Style>
                                        <TextBox.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="0"/>
                                            </Style>
                                        </TextBox.Resources>
                                    </TextBox>
                                    
                                    <!-- Magnifier icon -->
                                    <TextBlock Grid.Column="1"
                                               Text="ðŸ”"
                                               FontSize="12"
                                               Foreground="{DynamicResource Brush.Text.Secondary}"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </Border>
                            
                            <!-- Placeholder text (when empty) -->
                            <TextBlock Text="Search..."
                                       FontSize="12"
                                       Foreground="{DynamicResource Brush.Text.Secondary}"
                                       VerticalAlignment="Center"
                                       Margin="13,0,25,0"
                                       IsHitTestVisible="False">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SearchText, Converter={StaticResource IsNullOrEmptyConverter}}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding SearchText, Converter={StaticResource IsNullOrEmptyConverter}}" Value="False">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                        
                        <!-- Dropdown Autocomplete Panel (Popup - Overlay) -->
                        <!-- TCP-0.6.0: Popup overlay - does NOT affect layout -->
                        <Popup x:Name="SearchDropdownPopup"
                               Placement="Bottom"
                               PlacementTarget="{Binding ElementName=SearchTextBoxBorder}"
                               StaysOpen="False"
                               IsOpen="{Binding IsDropdownVisible}">
                            <Border Width="250"
                                    Background="{DynamicResource Brush.Surface}"
                                    BorderBrush="{DynamicResource Brush.Border}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    MaxHeight="200">
                                <ListBox ItemsSource="{Binding FilteredSuggestions}"
                                         SelectedItem="{Binding SelectedSearchItem}"
                                         BorderThickness="0"
                                         Background="Transparent"
                                         MaxHeight="200"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                                         MouseLeftButtonUp="SearchListBox_MouseLeftButtonUp"
                                         KeyDown="SearchListBox_KeyDown">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="{DynamicResource BackgroundPrimaryBrush}"
                                                    BorderThickness="0"
                                                    Padding="10,8"
                                                    Margin="2">
                                                <TextBlock Text="{Binding DisplayText}"
                                                           FontSize="12"
                                                           Foreground="{DynamicResource Brush.Text.Primary}"/>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="0"/>
                                            <Setter Property="Margin" Value="0"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ListBoxItem">
                                                        <Border Background="{TemplateBinding Background}"
                                                                BorderThickness="0"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
                                                            </Trigger>
                                                            <Trigger Property="IsSelected" Value="True">
                                                                <Setter Property="Background" Value="{DynamicResource AccentPrimaryBrush}"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>
                            </Border>
                        </Popup>
                    </Grid>
                    
                    <!-- Icons + Version -->
                    <StackPanel Grid.Column="1"
                                Grid.Row="0"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Margin="0,0,10,0">
                        
                        <!-- Settings icon (placeholder) -->
                        <TextBlock Text="âš™"
                                   FontSize="14"
                                   Foreground="{DynamicResource Brush.Text.Secondary}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,12,0"
                                   Cursor="Hand"
                                   ToolTip="Settings (coming soon)"/>
                        
                        <!-- Info icon (placeholder) -->
                        <TextBlock Text="â„¹"
                                   FontSize="14"
                                   Foreground="{DynamicResource Brush.Text.Secondary}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,12,0"
                                   Cursor="Hand"
                                   ToolTip="Info (coming soon)"/>
                        
                        <!-- Versiyon bilgisi -->
                        <TextBlock Text="{x:Static services:VersionManager.DisplayVersion}"
                                   FontSize="11"
                                   Foreground="{DynamicResource Brush.Text.Secondary}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,15,0"/>
                        
                        <!-- Window butonlarÄ±: Minimize, Maximize/Restore, Close -->
                        <StackPanel Orientation="Horizontal">
                        <!-- Minimize butonu -->
                        <Button Content="âˆ’"
                                Width="40"
                                Height="30"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{DynamicResource Brush.Text.Primary}"
                                FontSize="14"
                                Click="MinimizeButton_Click"
                                Cursor="Hand">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="0">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <!-- Maximize/Restore butonu -->
                        <Button x:Name="MaximizeRestoreButton"
                                Content="â–¡"
                                Width="40"
                                Height="30"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{DynamicResource Brush.Text.Primary}"
                                FontSize="14"
                                Click="MaximizeRestoreButton_Click"
                                Cursor="Hand">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="0">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <!-- Close butonu -->
                        <Button Content="Ã—"
                                Width="40"
                                Height="30"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{DynamicResource Brush.Text.Primary}"
                                FontSize="18"
                                Click="CloseButton_Click"
                                Cursor="Hand">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="0">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource AccentPrimaryBrush}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
        
        <!--
            ContentArea - Ana iÃ§erik alanÄ± (View switching)
            ContentControl ile View'ler arasÄ± geÃ§iÅŸ yapÄ±lÄ±r
        -->
        <ContentControl x:Name="ContentArea"
                        Grid.Row="1"
                        Background="{DynamicResource Brush.Background.Primary}">
            <!-- Default view: HomeView -->
            <views:HomeView/>
        </ContentControl>
    </Grid>
</Window>
